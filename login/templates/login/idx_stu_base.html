{% extends 'login/base.html' %}
{% block title %}主页{% endblock %}

{% block content %}
{% if request.session.is_login %}
<!--修改-->
<form id="update-info-form" action="#" method="post" class="form-horizontal" role="form">
    {% csrf_token %}
    <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="updateModalLabel">修改记录</h4>
          </div>
          <div class="modal-body" style="height: 100%;">
            <div class="form-label-group">
                <input type="password" class="form-control" name="update_password0" id="update_password0" placeholder="密码" required="required"></input>
                <label for="lastname" class="col-sm-3 control-label">密码</label>
            </div>
            <div class="form-label-group">
                <input type="password" class="form-control" name="update_password" id="update_password" placeholder="确认密码" required="required"></input>
                <label for="lastname" class="col-sm-3 control-label">确认密码</label>
            </div>
                <div class="form-label-group">
                <input type="text" class="form-control" name="update_email" id="update_email" placeholder="邮箱" required="required" autofocus></input>
            <label for="lastname" class="col-sm-3 control-label">邮箱</label>
            </div>
            <div class="form-label-group">
                <input type="text" class="form-control" name="update_name" id="update_name" placeholder="姓名" required="required"></input>
                <label for="lastname" class="col-sm-3 control-label">姓名</label>
            </div>
            <div class="form-group">
                <select data-placeholder="选择项目..." class="form-control" name="update_sex" id="update_sex" required="required">
                    <option value="male" hassubinfo="true">男</option>
                    <option value="female" hassubinfo="true">女</option>
                </select>
            </div>
            <div class="form-label-group">
                <input type="text" class="form-control" name="update_idc" id="update_idc" placeholder="身份证号" required="required"></input>
                <label for="lastname" class="col-sm-3 control-label">身份证号</label>
            </div>
            <div class="form-label-group">
                <input type="text" class="form-control" name="update_age" id="update_age" placeholder="年龄" required="required"></input>
                <label for="lastname" class="col-sm-3 control-label">年龄</label>
            </div>
            <div class="form-group">
                <select data-placeholder="选择项目..." class="form-control" name="update_major" id="update_major" required="required">
                    <option value="080901" hassubinfo="true">计算机科学与技术</option>
                    <option value="080902" hassubinfo="true">软件工程</option>
                    <option value="080903" hassubinfo="true">网络工程</option>
                    <option value="080904K" hassubinfo="true">信息安全</option>
                </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            <input type="button" data-dissmiss="modal" onclick="update_info()" class="btn btn-primary"value="提交">
          </div>
        </div>
      </div>
    </div>
</form>
  
<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link" href = "javascript:void(0);" onclick ="pop_up()">修改个人信息</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">查看奖惩情况</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">查看选课情况</a></li>
                    <li class="nav-item"><a class="nav-link" href="/student/choose_course/">进入选课系统</a></li>
                </ul>
            </div>
        </nav>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
            <!-- 主界面 -->
            <div class="col-md-10 col-md-offset-2 main">
                <h2 class="sub-header">{{ account }} {{ stu_info.name  }}</h2>
            </div>
            {% block main %}
            {% endblock %}
        </main>
    </div>
</div>


<script>
    toastr.options = {
          closeButton: true,
          debug: true,
          progressBar: true,
          positionClass: "toast-top-center",
          onclick: null,
          showDuration: "300",
          hideDuration: "1000",
          timeOut: "2000",
          extendedTimeOut: "1000",
          showEasing: "swing",
          hideEasing: "linear",
          showMethod: "fadeIn",
          hideMethod: "fadeOut"
      };
    function pop_up(){
        $('#updateModal').modal('show')
    }
    function update_info(){
        $.ajax({
            cache:false,
            type: "POST",
            dataType: "json",
            url: "./update/" ,
            data: $('#update-info-form').serialize(), //将模态框的form表单数据序列化，以便提交到后台
            async:false,  //必须要为false,必须必须

            success: function (data) {
                console.log(data);//打印服务端返回的数据(调试用)
                if(data.status == "success"){
                    document.getElementById("update-info-form").reset();
                    $('#updateModal').modal('hide');
                    toastr.success('提交数据成功');
                    $("#table").bootstrapTable('refresh');
                }
                if(data.status == "stuid0"){//报错信息写在这里，字段在view内定义
                    toastr.warning('请输入学号');
                }
                if(data.status == "email0"){
                    toastr.warning('请输入邮箱');
                }
                if(data.status == "name0"){
                    toastr.warning('请输入姓名');
                }
                if(data.status == "idc0"){
                    toastr.warning('请输入身份证号');
                }
                if(data.status == "age0"){
                    toastr.warning('请输入年龄');
                }
            },
            error : function() {
                toastr.warning("请输入所有数据");
            }
        });
    }
    
  </script>

{% else %}
<h1>你尚未登录，只能访问公开内容！</h1>

{% endif %}
{% endblock %}