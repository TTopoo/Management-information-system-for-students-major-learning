{% extends 'login/base.html' %}
{% block content %}
{% csrf_token %}
<style>
    .left {
        float: left;
    }

    .right {
        float: right;
    }

    .like {
        margin-right: 10px;
    }

    .item {
        margin-bottom: 20px;
    }
</style>
<!--修改-->
<form id="update-info-form" action="#" method="post" class="form-horizontal" role="form">
    {% csrf_token %}
    <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="updateModalLabel">修改记录</h4>
                </div>
                <div class="modal-body" style="height: 100%;">
                    <div class="form-label-group">
                        <input type="text" class="form-control" name="college" id="college" placeholder="原专业名称"
                            required="required" readonly></input>
                        <label for="lastname" class="col-sm-3 control-label">原专业名称</label>
                    </div>
                    <div class="form-label-group">
                        <input type="text" class="form-control" name="update_college" id="update_college"
                            placeholder="新专业名称" required="required"></input>
                        <label for="lastname" class="col-sm-3 control-label">新专业名称</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <input type="button" data-dissmiss="modal" onclick="update_info()" class="btn btn-primary"
                        value="提交">
                </div>
            </div>
        </div>
    </div>
</form>

<div class="item">
    <table id="table0">
        <thead>
            <tr>
                <th data-formatter="operateFormatter" data-events="operateEvents"></th>
            </tr>
        </thead>
    </table>
</div>
<div class="item">
    <table id="table1">
        <thead>
            <tr>
                <th data-formatter="operateFormatter" data-events="operateEvents"></th>
            </tr>
        </thead>
    </table>
</div>
<div class="item">
    <table id="table2">
        <thead>
            <tr>
                <th data-formatter="operateFormatter" data-events="operateEvents"></th>
            </tr>
        </thead>
    </table>
</div>
<div class="item">
    <table id="table3">
        <thead>
            <tr>
                <th data-formatter="operateFormatter" data-events="operateEvents"></th>
            </tr>
        </thead>
    </table>
</div>
<div class="item">
    <table id="table4">
        <thead>
            <tr>
                <th data-formatter="operateFormatter" data-events="operateEvents"></th>
            </tr>
        </thead>
    </table>
</div>


<script>
    var $table0 = $('#table0')
    var $table1 = $('#table1')

    var json = { 'json': '1' }
    var dta1 = new Array()
    var datalen
    $.ajax({
        url: "./json/",
        data: JSON.stringify(json),
        contentType: 'application/json',
        type: "POST",
        traditional: true,
        headers: { "X-CSRFToken": $('[name="csrfmiddlewaretoken"]').val() },
        success: function (data) {  //接收total、status、cname
            if (data.status == "success") {
                toastr.success('提交数据成功');
            }
            datalen = data.total
            for (i = 0; i < data.total; i++) {
                urls = "./json/" + i
                id = "#table" + i;
                $(id).bootstrapTable({
                    url: urls,
                    columns: [{
                        field: 'major_name',
                        title: data.cname[i]
                    }]
                })
            }
        },
        error: function () {
            toastr.warning("请输入所有数据");
        }
    });

    window.operateEvents = {
        'click .update': function (e, value, row) {
            $("#college").val(row.major_name);
            $("#update_college").val(row.major_name);
            $('#updateModal').modal('show')
        }
    }

    function operateFormatter(value, row, index) {
        return [
            '<div class="left">',
            value,
            '</div>',
            '<div class="right">',
            '<a class="update" href="javascript:void(0)" title="Like">',
            '<i class="far fa-edit"></i>',
            '</a>  ',
            '</div>'
        ].join('')
    }
    function update_info() {
        $.ajax({
            cache: false,
            type: "POST",
            dataType: "json",
            url: "./update/",
            data: $('#update-info-form').serialize(), //将模态框的form表单数据序列化，以便提交到后台
            async: false,  //必须要为false,必须必须

            success: function (data) {
                if (data.status == "success") {
                    document.getElementById("update-info-form").reset();
                    $('#updateModal').modal('hide');
                    toastr.success('修改数据成功');

                    location.reload()
                }
                if (data.status == "college0") {
                    toastr.warning('请输入新专业名称');
                }
            },
            error: function () {
                toastr.warning("请输入所有数据");
            }
        });
    }
</script>
{% endblock %}